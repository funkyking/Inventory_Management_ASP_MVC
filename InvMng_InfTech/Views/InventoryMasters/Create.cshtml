@model InvMng_InfTech.Models.Masters.InventoryMaster

@{
    ViewData["Title"] = "Create";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>



<div class="mt-4 mb-4">
    <div class="d-flex justify-content-sm-start">
        <a asp-action="Index" class="btn btn-secondary">
            <i class="fa-solid fa-arrow-left-long"></i>
            Back to List
        </a>
    </div>
</div>




<div class="d-flex justify-content-center mt-4">
    <form asp-action="create">
        <div class="card mb-4 shadow" style="max-width: 540px;">
            <div class="row g-0">
                <div class="col-sm-5 mb-sm-2 mt-3">
                    <div class="map-placeholder text-center">
                        <div class="d-flex justify-content-center align-content-center mt-sm-3">
                            <i class="fas fa-map-marked-alt fa-4x"></i>
                        </div>
                        <p class="mt-2 mb-4">Select location</p>
                    </div>
                </div>
                <div class="col-sm-7">
                    <div class="card-body">
                        <div class="form-group mb-2">
                            <label asp-for="Location" class="control-label">Location</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fa-solid fa-map"></i></span>
                                <input asp-for="Location" id="locationInput" class="form-control" />
                            </div>
                            <span asp-validation-for="Location" class="text-danger"></span>
                        </div>
                        <div class="form-group mb-2">
                            <label asp-for="SubLocation" class="control-label">Sub Location</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fa-solid fa-location-crosshairs"></i></span>
                                <input asp-for="SubLocation" id="subLocationInput" class="form-control" />
                            </div>
                            <span asp-validation-for="SubLocation" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-3 shadow" style="max-width: 540px;">
            <div class="row g-0">
                <div class="col-sm-5 mb-sm-2">
                    <div class="d-flex justify-content-center align-items-center">
                        <!-- Image display -->
                        <div class="mt-3 mb-3 text-center border" style="width: 150px; height: 150px; display: flex; align-items: center; justify-content: center;">
                            <div class="image-placeholder">
                                <!-- Display uploaded image here -->
                                <img id="partImagePreview" src="" alt="Part Image Preview" class="img-fluid" style="max-width: 150px; max-height: 150px; object-fit: cover;">
                            </div>
                        </div>
                    </div>
                    <!-- Image upload field -->
                    <div class="form-group d-flex justify-content-center mb-sm-2">
                        <label class="btn btn-outline-secondary">
                            <i class="fas fa-upload"></i>Load Image<input type="file" name="PartImage" class="d-none" accept="image/*" onchange="previewImage(this)">
                        </label>
                    </div>

                </div>
                <div class="col-sm-7">
                    <div class="card-body">
                        <div class="form-group mb-sm-2">
                            <label asp-for="Brand" class="control-label">Brand</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fa-solid fa-copyright"></i></span>
                                <input asp-for="Brand" id="brandInput" class="form-control" />
                            </div>
                            <span asp-validation-for="Brand" class="text-danger"></span>
                        </div>
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                        <div class="form-group mb-2">
                            <label asp-for="PartNumber" class="control-label">Part Number</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-cube"></i></span>
                                <input asp-for="PartNumber" id="partNumberInput" class="form-control" readonly/>
                                <button id="generatePartNumber" class="btn btn-outline-primary" type="button"><i class="fas fa-random"></i></button>
                            </div>
                            <span asp-validation-for="PartNumber" class="text-danger"></span>
                        </div>
                        <div class="form-group mb-2">
                            <label asp-for="PartName" class="control-label">Part Name</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-file-alt"></i></span>
                                <select asp-for="PartName" id="partNameInput" class="form-control">
                                    <option value="">Select Part Name</option>
                                </select>
                            </div>
                            <span asp-validation-for="PartName" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="d-grid gap-2 col-6 mx-auto shadow">
            <button type="submit" class="btn btn-primary btn-block">Create</button>
        </div>

    </form>
</div>



@section scripts {

    <script>
        // Function to preview uploaded image
        function previewImage(input) {
            var preview = document.getElementById('partImagePreview');
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    var img = new Image();
                    img.src = e.target.result;
                    img.onload = function () {
                        var canvas = document.createElement('canvas');
                        var ctx = canvas.getContext('2d');
                        canvas.width = 150;
                        canvas.height = 150;
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        preview.src = canvas.toDataURL('image/jpeg'); // You can also use 'image/png'
                    };
                }
                reader.readAsDataURL(input.files[0]);
            } else {
                preview.src = "";
            }
        }
    </script>

    <script>
        $(document).ready(function () {
            // Define the URL endpoints for fetching suggestions
            const locationUrl = '/InventoryMasters/GetLocations';
            const subLocationUrl = '/InventoryMasters/GetSubLocations';
            const brandUrl = '/InventoryMasters/GetBrandName';
            const partNameUrl = '/InventoryMasters/GetPartName';

            // Configure autocomplete for Location field
            $('#locationInput').autocomplete({
                source: locationUrl
            });

            // Configure autocomplete for SubLocation field
            $('#subLocationInput').autocomplete({
                source: subLocationUrl
            });


            $('#brandInput').autocomplete({
                source: brandUrl
            });

        });

    </script>

    <script>
        $(document).ready(function () {
            // Get the input element
            const partNumberInput = $('#partNumberInput');

            // Get the generate button
            const generateButton = $('#generatePartNumber');

            // Attach a click event to the generate button
            generateButton.click(function () {
                // Call the GenerateNewPartNumber action method
                $.get('/InventoryMasters/GeneratePartNumber', function (data) {
                    // Set the value of the input box
                    partNumberInput.val(data);
                });
            });
        });
    </script>

    <script>
        $(document).ready(function () { 
            function loadPartNames() {
                const brandValue = $('#brandInput').val();

                $.ajax({
                    url: '/InventoryMasters/GetPartName',
                    data: {
                        brand: brandValue
                    },
                    dataType: "json",
                    success: function (data) {

                        console.log(brandValue);
                        console.log(data);
                        const partNameDropdown = $('#partNameInput');
                        partNameDropdown.empty();
                        partNameDropdown.append($('<option>').val('').text('Select Part Name'));
                        $.each(data, function (index, value) {
                            partNameDropdown.append($('<option>').val(value).text(value));
                        });
                    }
                });
            }

            // Trigger the function when the Brand input changes
            $('#brandInput').on('change', loadPartNames);
        });
    </script>

    
}






